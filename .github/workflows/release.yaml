{
    name: release,
    on: { push: { branches: [main] } },
    permissions: { contents: write, packages: write },
    env:
        {
            GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}",
            SH_FILE_INPUT_NAME: "tftab",
        },
    jobs:
        {
            main:
                {
                    runs-on: ubuntu-latest,
                    steps:
                        [
                            {
                                name: Checkout code,
                                uses: actions/checkout@v3,
                                with: { fetch-depth: 0 },
                            },
                            {
                                name: Bump version and push tag,
                                id: tag_version,
                                uses: anothrNick/github-tag-action@1.61.0,
                                env:
                                    {
                                        GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}",
                                        WITH_V: false,
                                        DEFAULT_BUMP: patch,
                                        DRY_RUN: true,
                                    },
                            },
                            {
                                name: Generate SHA256 and rename script,
                                id: prepare_script,
                                if: success(),
                                env:
                                    {
                                        SH_FILE_INPUT: "${{ github.workspace }}/${{ env.SH_FILE_INPUT_NAME }}.sh",
                                        SH_FILE_OUTPUT: "${{ github.workspace }}/${{ env.SH_FILE_INPUT_NAME }}-${{steps.tag_version.outputs.tag }}.sh",
                                    },
                                run: 'mv ${{ env.SH_FILE_INPUT }} ${{ env.SH_FILE_OUTPUT }} && res=$(shasum -a 256 ${{ env.SH_FILE_OUTPUT }} | awk ''{ print $1 }'') && echo "SH_FILE_SHA=$res" >> $GITHUB_OUTPUT && echo "$res" > ${{ env.SH_FILE_OUTPUT }}.sha256',
                            },
                            {
                                name: Create GitHub Release,
                                if: success(),
                                uses: ncipollo/release-action@v1,
                                env:
                                    {
                                        SH_FILE_OUTPUT: "${{ github.workspace }}/${{ env.SH_FILE_INPUT_NAME }}-${{steps.tag_version.outputs.tag }}.sh",
                                        SH_FILE_SHA: "${{ steps.prepare_script.outputs.SH_FILE_SHA }}",
                                        GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}",
                                    },
                                with:
                                    {
                                        artifacts: "${{ env.SH_FILE_OUTPUT }}\n${{ env.SH_FILE_OUTPUT }}.sha256",
                                        tag: "${{ steps.tag_version.outputs.tag }}",
                                        name: "${{ steps.tag_version.outputs.tag }}",
                                        body: "Auto-generated release for ${{ steps.tag_version.outputs.tag }}\n\nSHA256 (tftab.sh): ${{ env.SH_FILE_SHA }}",
                                        draft: false,
                                        prerelease: false,
                                    },
                            },
                        ],
                },
        },
}
