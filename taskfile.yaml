# code generated by retab (devel). DO NOT EDIT.
# join the fight against yaml @ github.com/walteh/retab

# source: ".retab/task.retab"

version: 3
tasks:
    task-bin:
        generates:
            - bin/task
        dir: tools
        sources:
            - go.mod
            - go.sum
            - main.go
        cmds:
            - go build -mod=vendor -o ./bin/task github.com/go-task/task/v3/cmd/task
    buf-bin:
        generates:
            - bin/buf
        dir: tools
        sources:
            - go.mod
            - go.sum
            - main.go
        cmds:
            - go build -mod=vendor -o ./bin/buf github.com/bufbuild/buf/cmd/buf
    mockery-bin:
        generates:
            - bin/mockery
        dir: tools
        sources:
            - go.mod
            - go.sum
            - main.go
        cmds:
            - go build -mod=vendor -o ./bin/mockery github.com/vektra/mockery/v2
    gotestsum-bin:
        generates:
            - bin/gotestsum
        dir: tools
        sources:
            - go.mod
            - go.sum
            - main.go
        cmds:
            - go build -mod=vendor -o ./bin/gotestsum gotest.tools/gotestsum
    golangci-lint-bin:
        generates:
            - bin/golangci-lint
        dir: tools
        sources:
            - go.mod
            - go.sum
            - main.go
        cmds:
            - go build -mod=vendor -o ./bin/golangci-lint github.com/golangci/golangci-lint/cmd/golangci-lint
    tidy:
        cmds:
            - go mod tidy
            - cd tools && go mod tidy
            - go work vendor
    update:
        cmds:
            - go get -u -v ./... && go mod tidy
            - cd tools && go get -u -v ./... && go mod tidy
            - go work vendor
    retab-gen:
        run: when_changed
        deps: []
        generates: []
        dir: .
        sources:
            - .retab/*.retab
        cmds:
            - go run ./cmd/retab fmt && go run ./cmd/retab gen
    lint:
        deps:
            - golangci-lint-bin
        sources:
            - '**/*.go'
            - exclude: tools/**/*
            - ./tools/bin/golangci-lint
        cmds:
            - GOWORK=off ./tools/bin/golangci-lint run --config ./.golangci.yml
    test-ci:
        deps:
            - gotestsum-bin
        sources:
            - '**/*.go'
            - exclude: tools/**/*
            - ./tools/bin/gotestsum
        preconditions:
            - which go
        cmds:
            - ./tools/bin/gotestsum --junitfile test-reports/junit.xml -- -v -coverprofile=coverage.out -coverpkg=./... ./...
    buf-gen:
        deps:
            - buf-bin
            - retab-gen
        generates:
            - gen/buf/**/*
        dir: .
        sources:
            - proto/**/*.proto
            - ./tools/bin/buf
            - ./buf.gen.yaml
        cmds:
            - |
              ./tools/bin/buf generate --include-imports --include-wkt --exclude-path="./vendor" --template buf.gen.yaml --path=./proto
            - find ./gen/buf -maxdepth 5 -type f -mmin +1 -delete
    mockery-gen:
        deps:
            - mockery-bin
            - retab-gen
        generates:
            - gen/mockery/**/*
        dir: .
        sources:
            - './.mockery.yaml '
            - ./tools/bin/mockery
            - ./pkg/format/*.go
            - ./pkg/lang/*.go
        cmds:
            - './tools/bin/mockery --dir ./gen/mockery --config ./.mockery.yaml '
            - find ./gen/mockery -type f -mmin +1 -delete
    default:
        deps:
            - tools
            - gen
            - lint
            - test
    tools:
        deps:
            - task-bin
            - buf-bin
            - mockery-bin
            - gotestsum-bin
            - golangci-lint-bin
    gen:
        deps:
            - retab-gen
            - buf-gen
            - mockery-gen
