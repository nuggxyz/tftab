# code generated by retab. DO NOT EDIT.
# join the fight against yaml @ github.com/walteh/retab

# source: ".retab/task.retab"

version: 3
tasks:
    buf-bin:
        cmds:
            - go build -mod=vendor -o ./bin/buf github.com/bufbuild/buf/cmd/buf
        dir: tools
        generates:
            - bin/buf
        sources:
            - go.mod
            - go.sum
            - main.go
    buf-gen:
        cmds:
            - |
              ./tools/bin/buf generate --include-imports --include-wkt --exclude-path="./vendor" --template ./buf.gen.yaml --path=./proto
            - find ./gen/buf -maxdepth 5 -type f -mmin +1 -delete
        deps:
            - buf-bin
            - retab-gen
        dir: .
        generates:
            - gen/buf/**/*
        sources:
            - proto/**/*.proto
            - ./tools/bin/buf
            - ./buf.gen.yaml
    default:
        deps:
            - tools
            - gen
            - lint
            - test
    gen:
        deps:
            - retab-gen
            - buf-gen
            - mockery-gen
    golangci-lint-bin:
        cmds:
            - go build -mod=vendor -o ./bin/golangci-lint github.com/golangci/golangci-lint/cmd/golangci-lint
        dir: tools
        generates:
            - bin/golangci-lint
        sources:
            - go.mod
            - go.sum
            - main.go
    gotestsum-bin:
        cmds:
            - go build -mod=vendor -o ./bin/gotestsum gotest.tools/gotestsum
        dir: tools
        generates:
            - bin/gotestsum
        sources:
            - go.mod
            - go.sum
            - main.go
    lint:
        cmds:
            - GOWORK=off ./tools/bin/golangci-lint run --config ./.golangci.yml
        deps:
            - golangci-lint-bin
        sources:
            - '**/*.go'
            - exclude: tools/**/*
            - ./tools/bin/golangci-lint
    mockery-bin:
        cmds:
            - go build -mod=vendor -o ./bin/mockery github.com/vektra/mockery/v2
        dir: tools
        generates:
            - bin/mockery
        sources:
            - go.mod
            - go.sum
            - main.go
    mockery-gen:
        cmds:
            - ./tools/bin/mockery --dir ./gen/mockery --config ./.mockery.yaml
            - find ./gen/mockery -type f -mmin +1 -delete
        deps:
            - mockery-bin
            - retab-gen
        dir: .
        generates:
            - gen/mockery/**/*
        sources:
            - '**/*.go'
            - ./.mockery.yaml
            - ./tools/bin/mockery
    retab-gen:
        cmds:
            - go run ./cmd/retab fmt && go run ./cmd/retab gen
        deps: []
        dir: .
        generates:
            - gen/retab/**/*
        sources:
            - .retab/*.retab
            - ./tools/bin/mockery
    task-bin:
        cmds:
            - go build -mod=vendor -o ./bin/task github.com/go-task/task/v3/cmd/task
        dir: tools
        generates:
            - bin/task
        sources:
            - go.mod
            - go.sum
            - main.go
    test-ci:
        cmds:
            - ./tools/bin/gotestsum --junitfile test-reports/junit.xml -- -v -coverprofile=coverage.out -coverpkg=./... ./...
        deps:
            - gotestsum-bin
        preconditions:
            - which go
        sources:
            - '**/*.go'
            - exclude: tools/**/*
            - ./tools/bin/gotestsum
    tidy:
        cmds:
            - go mod tidy
            - cd tools && go mod tidy
            - go work vendor
    tools:
        deps:
            - buf-bin
            - golangci-lint-bin
            - gotestsum-bin
            - mockery-bin
            - task-bin
